<!DOCTYPE html>
<html class="light" lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Zonas - Gestión Territorial v2.0</title>

    <!-- Fuentes e Iconos -->
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />

    <!-- Leaflet CSS (Necesario para el mapa dinámico) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2563eb",
                        "primary-dark": "#1d4ed8",
                        "secondary": "#7c3aed",
                        "text-main": "#020617",
                        "text-sub": "#334155",
                    },
                    fontFamily: {
                        "display": ["Public Sans", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px" },
                },
            },
        }
    </script>

    <style>
        .district-label-tooltip {
            background: transparent;
            border: none;
            box-shadow: none;
            color: #dc2626;
            /* Red-600 */
            font-weight: 800;
            font-size: 14px;
            text-shadow:
                2px 2px 0px white,
                -1px -1px 0px white,
                1px -1px 0px white,
                -1px 1px 0px white,
                1px 1px 0px white;
        }
    </style>
    <!-- Estilos Personalizados -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Leaflet JS (Necesario para el mapa dinámico) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- PDF Generation Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body class="font-display text-text-main dark:text-white antialiased selection:bg-primary/30 bg-content">

    <!-- Navbar -->
    <header class="sticky top-4 z-50 mx-4 md:mx-8 glass-panel rounded-2xl mt-4">
        <div class="max-w-[1440px] mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center size-10 bg-primary/10 text-primary rounded-xl border border-primary/20 bg-white">
                    <span class="material-symbols-outlined text-2xl">grid_view</span>
                </div>
                <div class="hidden sm:flex flex-col">
                    <h1 class="text-lg font-bold tracking-tight text-text-main dark:text-white leading-none">Despliegue
                        Territorial</h1>
                    <span
                        class="text-[10px] font-extrabold text-primary uppercase tracking-[0.2em] leading-tight">Ciudad
                        Juárez</span>
                </div>
            </div>

            <nav class="hidden md:flex items-center gap-3">
                <a href="index.html"
                    class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl">Inicio</a>
                <a href="metodologia.html"
                    class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl">Metodología</a>
                <!-- ACTIVO -->
                <a href="zonas.html"
                    class="text-sm font-bold text-primary px-5 py-2.5 bg-white rounded-xl border border-primary/20 shadow-md">Zonas</a>
                <a href="historico.html"
                    class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl">Histórico
                    18-24</a>

                <a href="amigos.html"
                    class="text-sm font-medium text-text-sub px-5 py-2.5 bg-white/80 hover:bg-white rounded-xl border border-transparent hover:border-gray-200 hover:shadow-md transition-all hover:text-primary">Amigos</a>

                <div class="h-8 w-px bg-gray-300 dark:bg-white/10 mx-2"></div>

                <!-- Botón Mapa General (Enlace Externo) -->
                <a href="https://www.google.com/maps/d/edit?mid=1HLbLlf1Gl4OuR6RwUd0zENjCmhoA4II&usp=sharing"
                    target="_blank"
                    class="flex items-center gap-2 text-sm font-bold text-emerald-700 bg-emerald-50 border border-emerald-200 hover:bg-emerald-600 hover:text-white px-5 py-2.5 rounded-xl transition-all shadow-sm hover:shadow-emerald-500/30 hover:scale-105">
                    <span class="material-symbols-outlined text-[20px]">map</span>
                    Mapa General
                </a>
            </nav>

            <div class="flex items-center gap-3">
                <div id="save-status"
                    class="hidden items-center gap-2 px-3 py-1 bg-green-500/10 text-green-700 dark:text-green-300 border border-green-500/20 rounded-full text-xs font-bold transition-all animate-bounce bg-white">
                    <span class="material-symbols-outlined text-sm">cloud_done</span> Guardado
                </div>
                <button
                    class="p-2 text-text-sub bg-white/50 hover:bg-white rounded-full transition-all shadow-sm hover:shadow-md border border-transparent hover:border-gray-100">
                    <span class="material-symbols-outlined">notifications</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Contenido Principal: DASHBOARD DE ZONAS -->
    <main class="flex-1 max-w-[1440px] mx-auto w-full px-4 md:px-8 py-8 flex flex-col gap-6">

        <!-- Header & Controles Superiores -->
        <div class="flex flex-col gap-6">
            <div class="glass-panel p-6 rounded-2xl w-full border-l-4 border-l-primary shadow-xl">
                <h2 class="text-3xl md:text-4xl font-black tracking-tight mb-2 text-text-main dark:text-white">
                    Gestión de Zonas y Brigadistas 2026</h2>
                <p class="text-text-sub dark:text-slate-300 max-w-2xl text-sm font-medium">
                    Administre la cobertura territorial y asigne personal operativo a las zonas geográficas en
                    tiempo real.
                </p>
            </div>
        </div>

        <!-- Controles de Pestañas -->
        <div
            class="flex p-1 gap-1 bg-gray-100/50 dark:bg-white/5 rounded-xl border border-gray-200 dark:border-white/10 w-fit">
            <button onclick="switchTab('list')" id="tab-btn-list"
                class="cursor-pointer flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold transition-all shadow-sm bg-white text-primary dark:bg-slate-800 dark:text-white">
                <span class="material-symbols-outlined text-[20px]">list</span>
                Listado
            </button>
            <button onclick="switchTab('map')" id="tab-btn-map"
                class="cursor-pointer flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-bold text-text-sub dark:text-gray-400 hover:text-text-main dark:hover:text-white transition-all">
                <span class="material-symbols-outlined text-[20px]">map</span>
                Mapa de Cobertura
            </button>
        </div>
        </div>

        <!-- Tarjetas de Métricas -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div
                class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-gray-100 dark:border-slate-700 hover:border-primary/50 transition-all shadow-lg">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <span class="material-symbols-outlined text-6xl text-text-main">map</span>
                </div>
                <div
                    class="flex items-center gap-2 text-text-sub dark:text-slate-400 text-sm font-bold uppercase tracking-wider mb-2">
                    Total de Zonas
                </div>
                <p class="text-4xl font-black text-text-main dark:text-white" id="stat-total-zonas">0</p>
            </div>

            <div
                class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-green-200 dark:border-green-500/30 hover:border-green-500/60 transition-all shadow-lg bg-green-50/50 dark:bg-green-900/20">
                <div class="absolute -right-4 -top-4 w-24 h-24 bg-green-500/10 blur-3xl rounded-full"></div>
                <div
                    class="flex items-center gap-2 text-green-700 dark:text-green-400 text-sm font-bold uppercase tracking-wider mb-2">
                    <span class="material-symbols-outlined text-lg">check_circle</span>
                    Asignadas
                </div>
                <div class="flex items-end gap-2">
                    <p class="text-4xl font-black text-text-main dark:text-white" id="stat-asignadas">0</p>
                </div>
            </div>

            <div
                class="glass-panel p-6 rounded-2xl relative overflow-hidden group border border-orange-200 dark:border-orange-500/30 hover:border-orange-500/60 transition-all shadow-lg bg-orange-50/50 dark:bg-orange-900/20">
                <div class="absolute -right-4 -top-4 w-24 h-24 bg-orange-500/10 blur-3xl rounded-full"></div>
                <div
                    class="flex items-center gap-2 text-orange-700 dark:text-orange-400 text-sm font-bold uppercase tracking-wider mb-2">
                    <span class="material-symbols-outlined text-lg">pending</span>
                    Pendientes
                </div>
                <p class="text-4xl font-black text-text-main dark:text-white" id="stat-pendientes">0</p>
            </div>
        </div>
        </div>

        <!-- PESTAÑA 1: LISTADO -->
        <div id="tab-content-list" class="flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-4 duration-300">

            <!-- Guía de Interacción -->
            <div class="glass-panel p-4 rounded-2xl border border-primary/20 shadow-md">
                <h3
                    class="text-xs font-bold text-text-sub dark:text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary text-sm">touch_app</span> Guía de Interacción
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div
                        class="flex items-center gap-3 p-2 rounded-lg bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800">
                        <div
                            class="flex items-center justify-center size-8 rounded-full bg-blue-50 border border-blue-200 text-blue-600 shadow-sm">
                            <span class="material-symbols-outlined text-[18px]">public</span>
                        </div>
                        <div>
                            <p class="font-bold text-text-main dark:text-white text-xs">Mapa Seccional</p>
                            <p class="text-[10px] text-text-sub dark:text-gray-400 leading-tight">Mapa detallado de la
                                sección.</p>
                        </div>
                    </div>

                    <div
                        class="flex items-center gap-3 p-2 rounded-lg bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-800">
                        <div
                            class="flex items-center justify-center size-8 rounded-full bg-purple-50 border border-purple-200 text-purple-600 shadow-sm">
                            <span class="material-symbols-outlined text-[18px]">analytics</span>
                        </div>
                        <div>
                            <p class="font-bold text-text-main dark:text-white text-xs">Datos Seccionales</p>
                            <p class="text-[10px] text-text-sub dark:text-gray-400 leading-tight">Análisis estadístico.
                            </p>
                        </div>
                    </div>

                    <div
                        class="flex items-center gap-3 p-2 rounded-lg bg-emerald-50/50 dark:bg-emerald-900/10 border border-emerald-100 dark:border-emerald-800">
                        <div
                            class="inline-flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-50 text-emerald-700 border border-emerald-200">
                            <span class="material-symbols-outlined text-[14px]">map</span>
                            <span class="text-[10px] font-bold">Ver</span>
                        </div>
                        <div>
                            <p class="font-bold text-text-main dark:text-white text-xs">Ubicación General</p>
                            <p class="text-[10px] text-text-sub dark:text-gray-400 leading-tight">Ubicación en mapa
                                general.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Barra de Herramientas (Búsqueda y Filtros) -->
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between glass-panel p-3 rounded-2xl">
                <div class="relative w-full md:w-96 group">
                    <span
                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors">search</span>
                    <input id="searchInput"
                        class="w-full pl-10 pr-4 py-2.5 glass-input rounded-xl text-sm font-medium focus:ring-2 focus:ring-primary/20 focus:border-primary/50 outline-none placeholder:text-gray-400 transition-all"
                        placeholder="Buscar zona, ID o brigadista..." type="text" />
                </div>

                <div class="flex flex-wrap items-center gap-4 w-full md:w-auto z-20">
                    <div id="loading-indicator"
                        class="hidden flex items-center gap-2 px-4 py-2 text-sm text-primary font-bold bg-primary/10 rounded-lg">
                        <span
                            class="size-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></span>
                        Actualizando...
                    </div>
                    <div class="relative min-w-[180px]">
                        <select id="statusFilter" onchange="filterAndRender()"
                            class="w-full pl-4 pr-8 py-2.5 glass-input rounded-xl text-sm font-medium text-text-main dark:text-white hover:bg-white hover:shadow-md transition-all focus:ring-2 focus:ring-primary/20 outline-none appearance-none cursor-pointer">
                            <option value="all">Todo</option>
                            <option value="assigned">Asignada</option>
                            <option value="pending">Pendiente</option>
                        </select>
                        <span
                            class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm pointer-events-none">expand_more</span>
                    </div>

                    <div class="relative min-w-[220px]" id="distritoDropdown">
                        <button onclick="toggleDistritoDropdown()"
                            class="flex items-center justify-between w-full pl-4 pr-4 py-2.5 glass-input rounded-xl text-sm font-medium text-text-main dark:text-white hover:bg-white hover:shadow-md transition-all focus:ring-2 focus:ring-primary/20 outline-none">
                            <div class="flex items-center gap-2">
                                <span
                                    class="material-symbols-outlined text-gray-500 dark:text-gray-400 text-lg">filter_alt</span>
                                <span id="distritoButtonText" class="truncate">Todos los Distritos</span>
                            </div>
                            <span
                                class="material-symbols-outlined text-gray-400 text-sm transition-transform duration-200"
                                id="distritoArrow">expand_more</span>
                        </button>

                        <div id="distritoDropdownContent"
                            class="hidden absolute top-full left-0 mt-2 w-full max-h-60 overflow-y-auto bg-white dark:bg-slate-900 border border-gray-200 dark:border-gray-700 rounded-xl z-50 flex-col py-2 shadow-2xl animate-in fade-in zoom-in-95 duration-100">
                            <div
                                class="px-3 pb-2 border-b border-gray-100 dark:border-gray-700 sticky top-0 bg-white dark:bg-slate-900 z-10 pt-1">
                                <span
                                    class="text-xs font-bold text-text-sub uppercase tracking-wider">Seleccionar</span>
                            </div>
                            <div id="distritosCheckboxContainer" class="flex flex-col pt-1">
                                <!-- Checkboxes se generan aquí -->
                            </div>
                        </div>
                    </div>

                    <div class="h-8 w-px bg-gray-300 dark:bg-white/10 hidden md:block"></div>
                    <button onclick="fetchSheetData()"
                        class="flex items-center justify-center p-2.5 text-text-sub hover:text-primary hover:bg-primary/10 rounded-xl transition-all"
                        title="Refrescar">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>
            </div>

            <!-- Tabla de Datos -->
            <div class="glass-panel rounded-2xl overflow-hidden flex-1 flex flex-col z-0">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[1000px] text-left border-collapse">
                        <thead
                            class="bg-gray-50/80 dark:bg-black/20 border-b border-gray-200 dark:border-white/10 backdrop-blur-sm">
                            <tr>
                                <th class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[80px]">
                                    Orden</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[120px]">
                                    Zona</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[240px]">
                                    Sección</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[140px]">
                                    Estado</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[280px]">
                                    Brigadista</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[180px]">
                                    Teléfono</th>
                                <th
                                    class="px-6 py-5 text-xs font-bold text-text-sub uppercase tracking-wider w-[140px] text-center">
                                    Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-gray-200 dark:divide-white/10">
                            <!-- Las filas se generan con JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Footer de Tabla -->
                <div
                    class="px-6 py-4 border-t border-gray-200 dark:border-white/10 flex items-center justify-center sm:justify-between bg-gray-50/50 dark:bg-black/20 flex-wrap gap-4">
                    <p class="text-sm font-medium text-text-sub">Mostrando <span id="result-count"
                            class="font-bold text-primary">0</span> resultados</p>
                    <div
                        class="text-xs font-medium text-text-sub opacity-70 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full border border-gray-100">
                        <span class="material-symbols-outlined text-xs">info</span>
                        Los cambios se guardan automáticamente al salir del campo.
                    </div>
                </div>
            </div>
        </div> <!-- Fin Tab List -->

        <!-- PESTAÑA 2: MAPA -->
        <div id="tab-content-map"
            class="hidden flex-1 flex flex-col h-full min-h-[600px] animate-in fade-in slide-in-from-bottom-4 duration-300">
            <div
                class="glass-panel rounded-2xl p-1 flex-1 flex flex-col relative h-full overflow-hidden border border-gray-200 dark:border-slate-700 shadow-xl">
                <!-- Leyenda Flotante -->
                <div
                    class="absolute top-4 right-4 z-[500] bg-white/90 backdrop-blur-md p-3 rounded-xl shadow-lg border border-gray-200 flex flex-col gap-2 text-xs font-bold">
                    <div class="flex items-center gap-2">
                        <span class="size-3 rounded-full bg-blue-600 border border-blue-700"></span>
                        <span class="text-text-main">Asignada</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="size-3 rounded-full bg-slate-400 border border-slate-500"></span>
                        <span class="text-text-main">Pendiente</span>
                    </div>
                </div>

                <div id="leafletMap" class="w-full rounded-xl z-0 bg-gray-100" style="height: 75vh; min-height: 600px;">
                </div>
            </div>
        </div>
    </main>

    <!-- Modal / Plantilla Oculta para PDF (Ficha de Brigadista) -->
    <div id="ficha-overlay"
        class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header Modal -->
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg text-text-main">Vista Previa de Ficha</h3>
                <button onclick="closeFicha()" class="p-2 hover:bg-gray-200 rounded-full transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <!-- Area Imprimible -->
            <div class="overflow-y-auto p-8 bg-white flex-1" id="ficha-printable">
                <!-- Marco Legal/Decorativo -->
                <div class="border-4 border-double border-primary/20 p-6 h-full relative">
                    <!-- Marca de Agua -->
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-[0.03]">
                        <span class="material-symbols-outlined text-[300px]">how_to_vote</span>
                    </div>

                    <!-- Encabezado Ficha -->
                    <div class="text-center mb-8 relative z-10">
                        <h1 class="text-2xl font-black text-primary uppercase tracking-widest mb-1">Ficha de Asignación
                        </h1>
                        <p class="text-xs text-text-sub font-bold uppercase tracking-[0.3em]">Operativo Territorial 2026
                        </p>
                    </div>

                    <!-- Datos Principales -->
                    <div class="grid grid-cols-2 gap-6 mb-8 relative z-10">
                        <div class="space-y-4">
                            <div>
                                <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Brigadista
                                    Responsable</p>
                                <p class="text-xl font-bold text-text-main border-l-4 border-primary pl-3"
                                    id="pdf-nombre">--</p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Contacto
                                </p>
                                <p class="text-base font-medium text-text-sub pl-3" id="pdf-telefono">--</p>
                            </div>
                        </div>
                        <div class="space-y-4 text-right">
                            <div>
                                <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Zona
                                    Asignada</p>
                                <p class="text-4xl font-black text-text-main" id="pdf-zona">--</p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Distrito
                                    Local</p>
                                <span class="bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-bold"
                                    id="pdf-distrito">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Secciones -->
                    <div class="mb-8 relative z-10">
                        <div class="flex items-center gap-2 mb-4 border-b border-gray-100 pb-2">
                            <span class="material-symbols-outlined text-primary text-xl">share_location</span>
                            <h3 class="font-bold text-sm text-text-main uppercase">Cobertura Seccional</h3>
                        </div>

                        <div id="pdf-secciones-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <!-- Se rellenará dinámicamente -->
                        </div>
                    </div>

                    <!-- Footer Ficha -->
                    <div class="mt-8 pt-6 border-t border-gray-100 text-center relative z-10">
                        <p class="text-[10px] text-gray-400">
                            Documento generado digitalmente por la Plataforma de Gestión Territorial.
                            <br>Fecha de emisión: <span id="pdf-fecha"></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Botones Modal -->
            <div class="p-4 border-t bg-gray-50 flex justify-end gap-3 rounded-b-2xl">
                <button onclick="closeFicha()"
                    class="px-4 py-2 rounded-lg text-sm font-bold text-gray-600 hover:bg-gray-200 transition-colors">Cancelar</button>
                <button onclick="downloadPDF()"
                    class="px-6 py-2 rounded-lg text-sm font-bold text-white bg-gradient-to-r from-primary to-primary-dark shadow-lg hover:shadow-primary/30 hover:scale-105 transition-all flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">download</span> Descargar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Dinámico (Leaflet) -->

    <!-- Conexión a la Lógica JS -->
    <script src="js/app.js?v=16"></script>
</body>

</html>